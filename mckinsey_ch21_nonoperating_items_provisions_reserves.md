# McKinsey Valuation - Key Concepts for Valuation

## Chapter 21: Nonoperating Items, Provisions, and Reserves (Operating vs Non-Operating, Debt-Like Items, Normalisation, QoE)

### Core Concept
Nonoperating items and balance-sheet “reserves” can distort operating performance metrics and enterprise-to-equity bridges if they are not classified consistently. The practical task is to (1) separate operating from non-operating income/expense, (2) identify debt-like items (claims) that belong in the EV-to-equity bridge, and (3) normalise earnings and cash flows for one-offs and accounting-driven noise. This chapter is central to quality of earnings (QoE) and valuation comparability.

See also: Chapter 11 on reorganising financial statements; Chapter 16 on EV-to-equity bridge; Chapter 20 on taxes (timing differences and uncertain positions).

---

### Core Concept: “Nonoperating” is About Value Driver Relevance
An item is nonoperating if it is not generated by the core operations being valued or if it is not expected to recur in a steady state. This includes:
- Gains/losses on asset sales and revaluations
- Fair value changes unrelated to operating performance
- Restructuring charges and litigation settlements
- Income/expense from investments not needed for operations
- Foreign exchange effects not tied to operating hedges (case-by-case)

Practical rule: classify based on whether it (a) reflects operating performance and (b) will persist in forecasts/terminal value.

---

### Formula/Methodology

#### 1) Normalised Operating EBIT / EBITDA
```text
Normalised EBIT = Reported EBIT − Non-recurring Gains + Non-recurring Losses ± Reclassifications
Normalised EBITDA = Reported EBITDA − Non-recurring Gains + Non-recurring Losses ± Lease/Stock-comp consistency adjustments
```
Where:
- Add back non-recurring losses and subtract non-recurring gains to arrive at sustainable earnings.
- Reclassify mislabelled financing items (interest) out of operating profit.

#### 2) Identify debt-like items for the EV-to-equity bridge
Debt-like items are non-equity claims on the business that reduce value available to common shareholders. Typical examples:
```text
Debt-like items (examples): lease liabilities, pension deficits, certain provisions, deferred consideration, customer-related liabilities if not operating in nature (case-by-case), environmental obligations, litigation provisions, asset retirement obligations
```
Key principle: if the item behaves like financing (a claim with contractual-like priority), treat it as debt-like.

#### 3) Provisions vs reserves (mechanics and valuation relevance)
A provision is a liability of uncertain timing/amount but with a present obligation; reserves are often equity or internal allocations depending on accounting regime. Valuation focus:
- Whether the liability is real and cash-settling (affects EV-to-equity and/or future FCFF)
- Whether changes are operating or non-operating (affects earnings normalisation)

---

### Python Implementation
```python
from typing import Dict, Optional

def _num(x) -> bool:
    return isinstance(x, (int, float)) and x == x  # not NaN


def normalize_metric(reported: float,
                     nonrecurring_gains: float = 0.0,
                     nonrecurring_losses: float = 0.0,
                     reclassifications: float = 0.0) -> float:
    """
    Normalise an earnings metric.

    Normalised = reported - gains + losses + reclassifications

    Args:
        reported: reported metric (currency)
        nonrecurring_gains: gains included in reported metric (currency, >= 0)
        nonrecurring_losses: losses included in reported metric (currency, >= 0)
        reclassifications: signed amount to move items in/out of the metric (currency)

    Returns:
        float: normalised metric
    """
    for name, v in {"reported": reported, "nonrecurring_gains": nonrecurring_gains, "nonrecurring_losses": nonrecurring_losses, "reclassifications": reclassifications}.items():
        if not _num(v):
            raise ValueError(f"{name} must be numeric")
    if nonrecurring_gains < 0 or nonrecurring_losses < 0:
        raise ValueError("nonrecurring_gains and nonrecurring_losses must be >= 0")
    return reported - nonrecurring_gains + nonrecurring_losses + reclassifications


def is_debt_like(item: Dict[str, object]) -> bool:
    """
    Simple rule-based classifier for debt-like items.
    This is a heuristic; final classification requires judgement.

    Expected keys:
        - name: str
        - contractual: bool (is there a contractual/priority-like claim?)
        - cash_settling: bool (likely cash settlement?)
        - operating_nature: bool (is it part of day-to-day operations?)

    Returns:
        bool: True if debt-like (bridge item), False otherwise.

    Raises:
        ValueError: missing keys or invalid types.
    """
    required = ["name", "contractual", "cash_settling", "operating_nature"]
    for k in required:
        if k not in item:
            raise ValueError(f"Missing key: {k}")
    if not isinstance(item["name"], str) or item["name"].strip() == "":
        raise ValueError("name must be a non-empty string")
    for k in ["contractual", "cash_settling", "operating_nature"]:
        if not isinstance(item[k], bool):
            raise ValueError(f"{k} must be bool")

    # Heuristic: contractual + cash-settling + not operating -> debt-like
    return bool(item["contractual"] and item["cash_settling"] and (not item["operating_nature"]))


def equity_value_bridge(ev: float,
                        net_debt: float,
                        debt_like_items: Dict[str, float],
                        non_operating_assets: float = 0.0,
                        nci: float = 0.0,
                        preferred: float = 0.0) -> float:
    """
    Equity = EV - net debt - sum(debt-like) - NCI - preferred + non-operating assets.
    """
    if not _num(ev) or not _num(net_debt):
        raise ValueError("ev and net_debt must be numeric")
    if not isinstance(debt_like_items, dict):
        raise ValueError("debt_like_items must be a dict")
    total_debt_like = 0.0
    for k, v in debt_like_items.items():
        if not isinstance(k, str) or k.strip() == "":
            raise ValueError("debt-like item names must be non-empty strings")
        if not _num(v) or v < 0:
            raise ValueError(f"debt-like item '{k}' must be numeric and >= 0")
        total_debt_like += v
    for name, v in {"non_operating_assets": non_operating_assets, "nci": nci, "preferred": preferred}.items():
        if not _num(v) or v < 0:
            raise ValueError(f"{name} must be numeric and >= 0")
    return ev - net_debt - total_debt_like - nci - preferred + non_operating_assets


# Example usage
reported_ebitda = 520_000_000
ebitda_norm = normalize_metric(
    reported=reported_ebitda,
    nonrecurring_gains=25_000_000,      # e.g., gain on property sale included in EBITDA
    nonrecurring_losses=40_000_000,     # e.g., restructuring charge
    reclassifications=0.0
)

items = [
    {"name": "Lease liability", "contractual": True, "cash_settling": True, "operating_nature": False},
    {"name": "Warranty provision", "contractual": False, "cash_settling": True, "operating_nature": True},
    {"name": "Pension deficit", "contractual": True, "cash_settling": True, "operating_nature": False}
]

for it in items:
    print(it["name"], "debt-like?" , is_debt_like(it))

equity = equity_value_bridge(
    ev=6_800_000_000,
    net_debt=1_350_000_000,
    debt_like_items={"Leases": 420_000_000, "Pensions": 260_000_000, "Environmental": 90_000_000},
    non_operating_assets=120_000_000,
    nci=70_000_000
)

print(f"Normalised EBITDA: ${ebitda_norm/1e6:.0f}M")
print(f"Equity value: ${equity/1e9:.2f}B")
```

---

### Valuation Impact
Why this matters:
- Normalising earnings prevents paying for one-off gains or ignoring recurring costs disguised as “non-recurring.”
- Debt-like items materially affect equity value even if they do not show up as conventional debt.
- Misclassification creates peer incomparability (EV, EBITDA, ROIC) and can invert conclusions about performance and valuation.

Impact on multiples:
- EV/EBITDA is highly sensitive to (a) EBITDA normalisation and (b) whether EV includes leases/pensions/provisions.
- P/E is distorted by nonoperating gains/losses and one-off tax items; avoid using unadjusted P/E for QoE-heavy stories.

Impact on DCF:
- If a provision is a true cash obligation, it must be reflected either as (1) a reduction to EV in the bridge (debt-like) or (2) an operating cash outflow in FCFF, but not both.
- Terminal value must be based on sustainable operating performance; one-offs must be stripped out.

Practical adjustments:
```python
def provision_treatment_decision(provision_cashflow_in_fcff: bool, include_as_debt_like: bool) -> None:
    """Guardrail: prevents double counting."""
    if provision_cashflow_in_fcff and include_as_debt_like:
        raise ValueError("Double-count risk: provision included in FCFF and as debt-like item. Choose one approach.")
```

---

### Quality of Earnings Flags (Nonoperating/Provisions/Reserves)
⚠️ Frequent “one-off” add-backs every year (restructuring becomes recurring).  
⚠️ Gains on asset disposals included in EBITDA/EBIT and treated as sustainable.  
⚠️ Working capital benefits from delayed payables or under-provisioning used to inflate cash flow.  
⚠️ Large provision releases boosting profit without clear reduction in underlying risk/obligation.  
⚠️ Off-balance-sheet obligations or contingent liabilities not discussed (legal, environmental, guarantees).  
✅ Clear roll-forward of major provisions (opening, additions, utilisation, releases) and linkage to cash settlement.

---

### Sector-Specific Considerations

| Sector | Key issue | Typical treatment |
|---|---|---|
| Construction / contracting | Provisions for claims, losses, warranties | Scrutinise provision roll-forward and revenue recognition; treat true obligations as operating cash outflows |
| Energy / mining | Asset retirement obligations, environmental liabilities | Often debt-like or explicit future cash outflows; consider discount rate and timing |
| Retail / airlines | Leases and onerous contracts | Leases treated as debt-like; onerous contracts analysed for recurring cash impact |
| Financials | Fair value gains/losses and provisions | Separate trading vs non-trading; treat impairments and fair value items consistently with business model |
| Technology | Stock comp add-backs, capitalised costs | Treat stock comp as economic cost; normalise capitalisation differences across peers |

---

### Practical Comparison Tables

#### 1) Common Nonoperating Items (Treatment Guide)
| Item | P&L impact | Typical valuation treatment |
|---|---|---|
| Gain/loss on asset sale | Inflates/deflates EBIT/NI | Remove for normalised earnings; treat asset proceeds separately if recurring |
| Restructuring charges | Lowers EBIT/NI | Add back if truly non-recurring; verify recurrence and cash settlement |
| Litigation settlement | One-time expense/income | Normalise; consider ongoing legal risk in scenarios |
| Investment income (non-core) | Raises NI | Exclude from operating profit; include investment in non-operating assets |
| FX remeasurement (non-hedge) | Volatile | Normalise; treat as financing/nonoperating unless integral to ops |

#### 2) Provisions/Reserves Checklist (QoE)
| Question | Why it matters |
|---|---|
| Is there a clear obligation and expected cash settlement? | Determines if it is debt-like or operating |
| Are releases boosting profit repeatedly? | Potential earnings management |
| Is provision growth consistent with revenue/volume drivers? | Detect under/over-provisioning |
| Are contingent liabilities disclosed but not provisioned? | Hidden value leakage risk |
| Is there a mismatch between expense recognition and cash outflow timing? | DCF modelling consistency |

---

### Real-World Example (Normalise EBITDA + Treat a Provision Correctly)

Scenario: A company reports EBITDA including a property disposal gain and a large provision release. You normalise EBITDA, then decide whether the remaining provision should be treated as debt-like or as an operating cash outflow (but not both).

```python
reported_ebitda = 520_000_000
gain_included = 25_000_000
restructuring = 40_000_000
provision_release = 30_000_000  # boosts EBITDA but may reflect prior over-provisioning

# Normalise: remove gain and remove the benefit of a release (treat as non-recurring gain)
ebitda_norm = normalize_metric(
    reported=reported_ebitda,
    nonrecurring_gains=gain_included + provision_release,
    nonrecurring_losses=restructuring
)

print(f"Normalised EBITDA: ${ebitda_norm/1e6:.0f}M")

# Provision remaining on balance sheet
remaining_env_provision = 90_000_000

# Choose treatment: include as debt-like OR model in FCFF
provision_cashflow_in_fcff = False
include_as_debt_like = True
provision_treatment_decision(provision_cashflow_in_fcff, include_as_debt_like)

equity = equity_value_bridge(
    ev=6_800_000_000,
    net_debt=1_350_000_000,
    debt_like_items={"Environmental provision": remaining_env_provision},
    non_operating_assets=120_000_000,
    nci=70_000_000
)

print(f"Equity value after provision adjustment: ${equity/1e9:.2f}B")
```

Interpretation:
- Removing non-recurring gains and releases produces a sustainable earnings base for multiples and DCF.
- Treating a real, cash-settling provision as debt-like reduces equity value today; alternatively, you can model its cash outflow explicitly in FCFF if timing is clear.
